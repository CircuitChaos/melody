#include <avr/pgmspace.h>
#include "note.h"

/* Special values:
 *
 * 0xFF -- empty (no change in note)
 * 0xFE -- end marker
 *
 * Other values are meant to be put into the OCR register.
 */

static const uint8_t notes[] PROGMEM =
{
	0x61, 0xff, 0xff, 0xff, 0xff, 0xff, 0x56, 0xff,
	0x51, 0xff, 0xff, 0xff, 0x48, 0xff, 0xff, 0x51,
	0x48, 0xff, 0x6c, 0xff, 0xff, 0xff, 0x6c, 0xff,
	0x81, 0xff, 0x56, 0xff, 0x51, 0xff, 0x56, 0xff,
	0x61, 0xff, 0xff, 0xff, 0x61, 0xff, 0x56, 0xff,
	0x51, 0xff, 0xff, 0xff, 0x48, 0xff, 0xff, 0x51,
	0x48, 0xff, 0x6c, 0xff, 0xff, 0xff, 0x6c, 0xff,
	0x81, 0xff, 0x56, 0xff, 0x51, 0xff, 0x56, 0xff,
	0x61, 0xff, 0xff, 0xff, 0x61, 0xff, 0x56, 0xff,
	0x51, 0xff, 0xff, 0xff, 0x40, 0xff, 0xff, 0xff,
	0x56, 0xff, 0xff, 0xff, 0xff, 0xff, 0x51, 0xff,
	0x48, 0xff, 0xff, 0xff, 0x3d, 0xff, 0xff, 0xff,
	0x61, 0xff, 0xff, 0xff, 0x61, 0xff, 0x56, 0xff,
	0x51, 0xff, 0xff, 0xff, 0x40, 0xff, 0xff, 0xff,
	0x56, 0xff, 0xff, 0xff, 0xff, 0xff, 0x56, 0xff,
	0x81, 0xff, 0x56, 0xff, 0x51, 0xff, 0x56, 0xff,
	0xfe
};

uint8_t note_get(void)
{
	static uint16_t pos = 0;
	uint8_t note;

	note = pgm_read_byte_near(notes + pos++);
	if (note == 0xFE)
	{
		pos = 0;
		note = pgm_read_byte_near(notes + pos++);
	}

	return note;
}
